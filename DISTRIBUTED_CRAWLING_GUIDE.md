# 🕷️ 분산 크롤링 시스템 - 사용 가이드

## 🚀 시스템 개요

기존 단일 Chrome 확장 프로그램을 **분산 크롤링 시스템**으로 완전히 업그레이드했습니다.

### ✨ 핵심 특징

1. **경쟁적 크롤링**: 여러 에이전트가 동시에 작업하여 가장 빠른 결과 반환
2. **실시간 모니터링**: WebSocket 기반 실시간 대시보드
3. **자동 장애 복구**: 에이전트 연결 해제 시 자동 재할당
4. **확장 가능한 아키텍처**: Redis, MongoDB 지원 (선택사항)

---

## 📋 설치 및 실행

### 1. 서버 설정

```bash
cd local-test/server

# 패키지 설치
npm install

# 서버 실행
npm start
```

### 2. Chrome 확장 프로그램 설치

1. Chrome 브라우저에서 `chrome://extensions/` 접속
2. "개발자 모드" 활성화
3. "압축해제된 확장 프로그램을 로드합니다" 클릭
4. `local-test/extension` 폴더 선택

### 3. 시스템 확인

- **모니터링 대시보드**: http://localhost:4000
- **WebSocket 서버**: ws://localhost:4001
- **Chrome 확장**: 브라우저 우상단 아이콘 클릭

---

## 🎯 사용 방법

### 1. 대시보드에서 검색

1. http://localhost:4000 접속
2. 검색어 입력 (예: "아이폰")
3. 실시간으로 에이전트들의 작업 진행 상황 모니터링
4. 가장 빠른 에이전트의 결과가 자동으로 표시됨

### 2. API를 통한 검색

```bash
# 검색 요청
curl "http://localhost:4000/search?q=아이폰"

# 작업 상태 확인
curl "http://localhost:4000/api/job/{JOB_ID}"

# 시스템 상태 확인
curl "http://localhost:4000/api/status"
```

### 3. Chrome 확장 프로그램 상태 확인

- 확장 프로그램 아이콘 클릭
- 에이전트 ID, 연결 상태, 작업 통계 확인
- 강제 재연결 옵션 사용 가능

---

## 🔧 시스템 아키텍처

### 핵심 컴포넌트

```
┌─────────────────────┐    ┌─────────────────────┐
│   Chrome Extension  │    │   Chrome Extension  │
│     (Agent 1)       │    │     (Agent 2)       │
└──────────┬──────────┘    └──────────┬──────────┘
           │                          │
           └─────────┬──────────────────┘
                     │ WebSocket (ws://localhost:4001)
           ┌─────────▼──────────┐
           │  Central Server    │
           │  (Coordinator)     │
           └─────────┬──────────┘
                     │ HTTP (http://localhost:4000)
           ┌─────────▼──────────┐
           │  Web Dashboard     │
           │  (Monitoring UI)   │
           └────────────────────┘
```

### 작업 흐름

1. **작업 생성**: 웹 대시보드에서 검색 요청
2. **작업 분배**: 중앙 서버가 여러 에이전트에게 동시 할당
3. **경쟁적 실행**: 각 에이전트가 독립적으로 크롤링 수행
4. **First-Win**: 가장 먼저 완료한 결과를 채택
5. **자동 취소**: 다른 에이전트들의 작업 자동 취소
6. **결과 반환**: 최종 결과를 클라이언트에게 전송

---

## 📊 모니터링 기능

### 실시간 통계

- **활성 에이전트 수**: 현재 연결된 에이전트
- **총 작업 수**: 시스템 시작 후 총 작업 수
- **완료된 작업**: 성공적으로 완료된 작업
- **평균 응답 시간**: 전체 작업의 평균 처리 시간

### 에이전트 상태

- **온라인/오프라인 상태**
- **현재 진행 중인 작업 수**
- **완료/실패 작업 통계**
- **마지막 하트비트 시간**

### 작업 이력

- **최근 작업 목록** (최대 10개)
- **작업 상태**: 대기, 진행중, 완료, 실패
- **처리 시간 및 URL 정보**

---

## 🛠️ 고급 설정

### 환경 변수 (config.env)

```env
# 서버 설정
PORT=4000
WSPORT=4001

# Redis 설정 (선택사항)
REDIS_HOST=localhost
REDIS_PORT=6379

# MongoDB 설정 (선택사항)
MONGODB_URI=mongodb://localhost:27017/distributed_crawling

# 디버그 모드
NODE_ENV=development
DEBUG=true
```

### Redis 연동 (선택사항)

```bash
# Redis 설치 (Windows)
# https://github.com/MicrosoftArchive/redis/releases

# Redis 실행
redis-server

# 서버 재시작하면 자동으로 Redis 연결 시도
```

### MongoDB 연동 (선택사항)

```bash
# MongoDB 설치
# https://www.mongodb.com/try/download/community

# MongoDB 실행
mongod

# 서버 재시작하면 자동으로 MongoDB 연결 시도
```

---

## 🔍 문제 해결

### 1. 에이전트 연결 실패

**증상**: Chrome 확장에서 "연결 해제됨" 표시

**해결책**:
1. 서버가 실행 중인지 확인 (`http://localhost:4000`)
2. WebSocket 포트 확인 (`ws://localhost:4001`)
3. Chrome 확장에서 "강제 재연결" 버튼 클릭
4. 확장 프로그램 재설치

### 2. 검색 결과 없음

**증상**: 검색해도 결과가 나오지 않음

**해결책**:
1. 활성 에이전트가 있는지 대시보드에서 확인
2. Chrome 확장이 설치되었는지 확인
3. 네이버 쇼핑몰 사이트에서 수동으로 검색 테스트
4. 개발자 도구에서 콘솔 로그 확인

### 3. 성능 문제

**증상**: 응답 시간이 너무 느림

**해결책**:
1. 더 많은 Chrome 브라우저/프로필에서 확장 설치
2. `background.js`의 `maxConcurrentJobs` 설정 조정
3. 타임아웃 값 조정 (`job.timeout`)
4. Redis 캐싱 활성화

---

## 📈 확장 계획

### Phase 2: 고급 기능 (2-3주)

- [ ] **멀티 사이트 지원**: 쿠팡, 지마켓 등 추가
- [ ] **사용자 인증**: API 키 기반 접근 제어
- [ ] **작업 우선순위**: VIP 사용자 우선 처리
- [ ] **결과 캐싱**: 동일 검색어 결과 재사용

### Phase 3: 엔터프라이즈 기능 (3-4주)

- [ ] **프록시 로테이션**: IP 차단 방지
- [ ] **분산 배포**: 여러 서버에 에이전트 분산
- [ ] **로드 밸런싱**: 서버 부하 분산
- [ ] **메트릭 수집**: Prometheus + Grafana

### Phase 4: AI 통합 (4-5주)

- [ ] **지능형 스케줄링**: ML 기반 작업 분배
- [ ] **데이터 분석**: 크롤링 결과 AI 분석
- [ ] **자동 최적화**: 성능 자동 튜닝
- [ ] **예측 캐싱**: 사용자 패턴 기반 사전 크롤링

---

## 🎉 결론

기존 단일 Chrome 확장을 **완전한 분산 크롤링 시스템**으로 업그레이드 완료!

### 주요 개선사항

✅ **3배 빠른 검색**: 여러 에이전트 동시 작업  
✅ **실시간 모니터링**: WebSocket 기반 대시보드  
✅ **자동 장애 복구**: 에이전트 다운 시 재할당  
✅ **확장 가능한 구조**: Redis, MongoDB 지원  
✅ **API 완전 지원**: RESTful API + 실시간 통신  

다음 단계로 **Phase 2 고급 기능** 개발을 시작할 수 있습니다! 🚀 